<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Dratewka costam costam</title>
    <style>
        body {
            font-family: font1;
            color: lightgray;
            background-color: rgb(50,50,50);
            font-size: 16px;
            padding-top: 40px;
            padding-left: 20px;
        }

        @font-face {
            font-family: font1;
            src: url('fonts/PressStart2P.ttf') format('truetype');
        }

        img {
            width: 320px;
            height: 200px;
            border: 4px lightgrey solid;
            margin-top: 5px;
        }
    </style>
    <script>
            //zdefiinowac funkcję Lokacja(text, grafika, kolor, drogi)

            var Config = {
                defaultPrompt: "What now?"
            }

            var caps = true

            function Lokacja(txt, img, color, canGo, item) {
                this.txt = txt;
                this.img = img;
                this.color = color;
                this.canGo = canGo;
                this.item = item;
            }

            function Przedmiot(comm, flag, name) {
                this.comm = comm;
                this.flag = flag;
                this.name = name;
            }
            var
            char = {
                x: 6,
                y: 3,
                item:[],
                cond:0
            }
            var
            lokalizacja={

                lokacja: [
                        [new Lokacja("You are inside a brimstone mine", "11.gif", "rgb(235,211,64)", [0, 1, 0, 0], []),
                        new Lokacja("You are at the entrance to the mine", "12.gif", "rgb(89,93,87)", [0, 1, 0, 1], []),
                        new Lokacja("A hill", "13.gif", "rgb(117,237,243)", [0, 1, 1, 1], []),
                        new Lokacja("Some bushes", "14.gif", "rgb(202,230,51)", [0, 1, 0, 1], []),
                        new Lokacja("An old deserted hut", "15.gif", "rgb(220,204,61)", [0, 1, 0, 1], []),
                        new Lokacja("The edge of a forest", "16.gif", "rgb(167,245,63)", [0, 1, 0, 1], []),
                        new Lokacja("A dark forest", "17.gif", "rgb(140,253,99)", [0, 0, 1, 1], [])],

                        [new Lokacja("A man nearby making tar", "21.gif", "rgb(255,190,99)", [0, 1, 1, 0], []),
                        new Lokacja("A timber yard", "22.gif", "rgb(255,190,99)", [0, 1, 1, 1], []),
                        new Lokacja("You are by a roadside shrine", "23.gif", "rgb(167,245,63)", [1, 1, 1, 1], []),
                        new Lokacja("You are by a small chapel", "24.gif", "rgb(212,229,36)", [0, 1, 0, 1], []),
                        new Lokacja("You are on a road leading to a wood", "25.gif", "rgb(167,245,63)", [0, 1, 1, 1], []),
                        new Lokacja("You are in a forest", "26 i 65.gif", "rgb(167,245,63)", [0, 1, 0, 1], []),
                        new Lokacja("You are in a deep forest", "27 i 67.gif", "rgb(140,253,99)", [1, 0, 0, 1], [])],

                        [new Lokacja("You are by the Vistula River", "31.gif", "rgb(122,232,252)", [1, 1, 0, 0], []),
                        new Lokacja("You are by the Vistula River", "32.gif", "rgb(140,214,255)", [1, 0, 0, 1], []),
                        new Lokacja("You are on a bridge over river", "33.gif", "rgb(108,181,242)", [1, 0, 1, 0], []),
                        new Lokacja("You are by the old tavern", "34.gif", "rgb(255,189,117)", [0, 1, 0, 0], []),
                        new Lokacja("You are at the town's end", "35.gif", "rgb(255,190,99)", [1, 0, 1, 1], []),
                        new Lokacja("You are in a butcher's shop", "36.gif", "rgb(255,188,102)", [0, 0, 1, 0], []),
                        new Lokacja("You are in a cooper's house", "37.gif", "rgb(255,188,102)", [0, 0, 1, 0], [])],

                        [new Lokacja("You are in the Wawel Castle", "41.gif", "rgb(255,176,141)", [0, 1, 0, 0], []),
                        new Lokacja("You are inside a dragon's cave", "42.gif", "rgb(198,205,193)", [0, 1, 0, 1], []),
                        new Lokacja("A perfect place to set a trap", "43.gif", "rgb(255,176,141)", [1, 0, 0, 1], []),
                        new Lokacja("You are by the water mill", "44.gif", "rgb(255,190,99)", [0, 1, 0, 0], []),
                        new Lokacja("You are at a main crossroad", "45.gif", "rgb(255,190,99)", [1, 1, 1, 1], []),
                        new Lokacja("You are on a town street", "46.gif", "rgb(255,190,99)", [1, 1, 0, 1], []),
                        new Lokacja("You are in a frontyard of your house", "47.gif", "rgb(255,190,99)", [1, 0, 1, 1], [])],

                        [new Lokacja("-brak-", "-brak-", "-brak-", [0, 0, 0, 0], []),
                        new Lokacja("-brak-", "-brak-", "-brak-", [0, 0, 0, 0], []),
                        new Lokacja("-brak-", "-brak-", "-brak-", [0, 0, 0, 0], []),
                        new Lokacja("You are by a swift stream", "54.gif", "rgb(108,181,242)", [0, 1, 0, 0], []),
                        new Lokacja("You are on a street leading forest", "55.gif", "rgb(255,190,99)", [1, 0, 1, 1], []),
                        new Lokacja("You are in a woodcutter's backyard", "56.gif", "rgb(255,190,99)", [0, 0, 1, 0], []),
                        new Lokacja("You are in a shoemaker's house", "57.gif", "rgb(254,194,97)", [1, 0, 0, 0], [])],

                        [new Lokacja("-brak-", "-brak-", "-brak-", [0, 0, 0, 0], []),
                        new Lokacja("-brak-", "-brak-", "-brak-", [0, 0, 0, 0], []),
                        new Lokacja("-brak-", "-brak-", "-brak-", [0, 0, 0, 0], []),
                        new Lokacja("You are in a bleak funeral house", "64.gif", "rgb(254,194,97)", [0, 1, 0, 0], []),
                        new Lokacja("You are on a path leading to the wood", "26 i 65.gif", "rgb(167,245,63)", [1, 1, 0, 1], []),
                        new Lokacja("You are at the edge of a forest", "66.gif", "rgb(167,245,63)", [1, 1, 0, 1], []),
                        new Lokacja("You are in a deep forest", "27 i 67.gif", "rgb(140,253,99)", [0, 0, 0, 1], [])]
                ]
            }
            var przedmiot = [];
            {
                przedmiot[10] = new Przedmiot("a KEY", "1", "KEY");
                przedmiot[11] = new Przedmiot(" an AXE", "1", "AXE");
                przedmiot[12] = new Przedmiot("STICKS", "1", "STICKS");
                przedmiot[13] = new Przedmiot("sheeplegs", "0", "sheeplegs");
                przedmiot[14] = new Przedmiot("MUSHROOMS", "1", "MUSHROOMS");
                przedmiot[15] = new Przedmiot("MONEY", "1", "MONEY");
                przedmiot[16] = new Przedmiot("a BARREL", "1", "BARREL");
                przedmiot[17] = new Przedmiot("a sheeptrunk", "0", "sheeptrunk");
                przedmiot[18] = new Przedmiot("BERRIES", "1", "BERRIES");
                przedmiot[19] = new Przedmiot("WOOL", "1", "WOOL");
                przedmiot[20] = new Przedmiot("a sheepskin", "0", "sheepskin");
                przedmiot[21] = new Przedmiot("a BAG", "1", "BAG");
                przedmiot[22] = new Przedmiot("a RAG", "1", "RAG");
                przedmiot[23] = new Przedmiot("a sheephead", "0", "sheephead");
                przedmiot[24] = new Przedmiot("a SPADE", "1", "SPADE");
                przedmiot[25] = new Przedmiot("SULPHUR", "1", "SULPHUR");
                przedmiot[26] = new Przedmiot("a solid poison", "0", "solid poison");
                przedmiot[27] = new Przedmiot("a BUCKET", "1", "BUCKET");
                przedmiot[28] = new Przedmiot("TAR", "1", "TAR");
                przedmiot[29] = new Przedmiot("a liquid poison", "0", "liquid poison");
                przedmiot[30] = new Przedmiot("a dead dragon", "0", "dead dragon");
                przedmiot[31] = new Przedmiot("a STONE", "1", "STONE");
                przedmiot[32] = new Przedmiot("a FISH", "1", "FISH");
                przedmiot[33] = new Przedmiot("a KNIFE", "1", "KNIFE");
                przedmiot[34] = new Przedmiot("a DRAGONSKIN", "1", "DRAGONSKIN");
                przedmiot[35] = new Przedmiot("a dragonskin SHOES", "1", "SHOES");
                przedmiot[36] = new Przedmiot("a PRIZE", "1", "PRIZE");
                przedmiot[37] = new Przedmiot("a SHEEP", "1", "SHEEP");
            }
            {
                lokalizacja.lokacja[0][2].item.push(przedmiot[31]);
                lokalizacja.lokacja[0][4].item.push(przedmiot[27]);
                lokalizacja.lokacja[0][6].item.push(przedmiot[14]);
                lokalizacja.lokacja[1][2].item.push(przedmiot[10]);
                lokalizacja.lokacja[1][6].item.push(przedmiot[18]);
                lokalizacja.lokacja[2][1].item.push(przedmiot[32]);
                lokalizacja.lokacja[3][3].item.push(przedmiot[21]);
                lokalizacja.lokacja[4][4].item.push(przedmiot[33]);
                lokalizacja.lokacja[5][3].item.push(przedmiot[24]);
            }
            //funkcja lokacji i jej kod

            //tworzenie html (texty grafiki itp)
            //input / prompt to w  co sie wpisuje komendy
            /// kod co sie dzieje jak sie cos wpisze
            // początkowo, klawisze

            /*document.body.onkeypress = function (e) {
                    console.log(e.which, e.key)
                }*/

            //dla odpowiednich klawiszy odpowiednie zachowanie
            //litery wpisuje, enter zatwierdza itd, inne nic
            //po enterze sprawdzasz zawartosc komendy i wykonuje jej funkcje (http://www.mendela.pl/trzy/ Dratewka cz1,3,6)
            /*
            funkcja lokacji {
                html
                document.body.onkeypress = function (e) {
                    console.log(e.which, e.key)
                    sprawdzanie (E, EAST, USE itd) komend {
                        kod komendy

                        //w kazdej komendzie co sie dzieje
                        np tutaj  lokacja(arg)

                    }
                }
            }
            */

            var Directions = { NORTH: 0, EAST: 1, SOUTH: 2, WEST: 3 }

            function getDirections(canGo) {
                let arr = []

                if (canGo[0]) {
                    arr.push(Directions.NORTH)
                }

                if (canGo[1]) {
                    arr.push(Directions.EAST)
                }

                if (canGo[2]) {
                    arr.push(Directions.SOUTH)
                }

                if (canGo[3]) {
                    arr.push(Directions.WEST)
                }

                return arr
            }

            function create_screen() {

                console.log(char.x + 1, char.y + 1, "(dane poprawione) (create_screen)")
                var now = document.createElement("div");
                now.id = "now"
                var img = document.createElement("img");
                img.id = "img"
                var canGO = document.createElement("p");
                canGO.id = "canGo"
                var canSEE = document.createElement("p");
                canSEE.id="canSee"
                var carry = document.createElement("p");
                var whatNOW = document.createElement("p");
                var prompt = document.createElement("div");
                prompt.id = "prompt"

                document.body.appendChild(now)
                document.body.appendChild(img)
                document.body.appendChild(canGO)
                document.body.appendChild(canSEE)
                document.body.appendChild(carry)
                document.body.appendChild(whatNOW)
                document.body.appendChild(prompt)
            }

            function update_screen(currentLocation) {
                var canGO = document.getElementById("canGo")
                var prompt = document.getElementById("prompt")
                var now = document.getElementById("now")
                var img = document.getElementById("img")

                var dirNames = ""
                let tablicaKieronkow = getDirections(currentLocation.canGo)

                for (let i = 0; i < tablicaKieronkow.length; i++) {
                    if (tablicaKieronkow[i] == Directions.NORTH) { // zrob cos
                        dirNames += "NORTH, "
                    }

                    if (tablicaKieronkow[i] == Directions.SOUTH) { // zrob cos
                        dirNames += "SOUTH, "
                    }

                    if (tablicaKieronkow[i] == Directions.WEST) { // zrob cos
                        dirNames += "WEST, "
                    }

                    if (tablicaKieronkow[i] == Directions.EAST) { // zrob cos
                        dirNames += "EAST, "
                    }
                }

                canGO.innerHTML += dirNames

                prompt.innerHTML = Config.defaultPrompt

                now.innerHTML = lokalizacja.lokacja[char.y][char.x].txt
                img.setAttribute("src", "img/" + lokalizacja.lokacja[char.y][char.x].img)
                img.style.backgroundColor = currentLocation.color;
                canSee.innerHTML = "You can see " + "nothing." //////////////////////////////////TODO

                //var itxt = document.createElement("p");
                //itxt.style.display = "default";

                //head.innerHTML = currentLocation.txt;
                //img.setAttribute("src", "gfx/" + currentLocation.img);
                //img.style.backgroundColor = currentLocation.color;

            }

            window.onload = function() {
                //powitalne ekran ( 1 hejnal, 2 texty)

                //wywołac funkcje ładowania funkcji lokacji

                //======= START ====== //
                var currentLocation = lokalizacja.lokacja[char.y][char.x]
                create_screen(currentLocation);
                update_screen(currentLocation)

                document.body.onkeydown = function(e) {
                let input = e.key
                let prompt = document.getElementById("prompt")
                let commandLine = prompt.innerHTML
                let command = commandLine.slice(Config.defaultPrompt.length, commandLine.length)
                let words = command.split(" ")
                console.log(e.key)

                switch (input) {

                    case "Backspace": {
                        if (commandLine.length > Config.defaultPrompt.length) {
                            prompt.innerHTML = commandLine.slice(0, commandLine.length - 1)
                        }
                    } break;

                    case "Enter": {

                        command = command.trim()
                        words = command.split(" ")
                        prompt.innerHTML = Config.defaultPrompt

                        switch (words[0]) {
                            case "E": case "EAST": {
                                if (char.x < 6) {
                                    char.x += 1
                                    currentLocation = lokalizacja.lokacja[char.y][char.x]
                                    update_screen(currentLocation)
                                } else {
                                    console.log("Out of bounds")
                                }
                            } break;

                            case "W": case "WEST": {
                                if (char.x > 1) {
                                    char.x -= 1
                                    currentLocation = lokalizacja.lokacja[char.y][char.x]
                                    update_screen(currentLocation)
                                } else {
                                    console.log("Out of bounds")
                                }
                            } break;

                            case "N": case "NORTH": {
                                if (char.y > 1) {
                                    char.y -= 1
                                    currentLocation = lokalizacja.lokacja[char.y][char.x]
                                    update_screen(currentLocation)
                                } else {
                                    console.log("Out of bounds")
                                }
                            } break;

                            case "S":case "SOUTH": {
                                if (char.y < 5) {
                                    char.y += 1
                                    currentLocation = lokalizacja.lokacja[char.y][char.x]
                                    update_screen(currentLocation)
                                } else {
                                    console.log("Out of bounds")
                                }
                            } break;

                            case "?":
                            case "V":
                            case "VOCABULARY": {
                                console.log("<p>NORTH or N, SOUTH or S</p>" +
                                    "<p>WEST or W, EAST or E</p>" +
                                    "<p>TAKE (object) or T (object)</p>" +
                                    "<p>DROP (object) or D (object)</p>" +
                                    "<p>USE (object) or U (object)</p>" +
                                    "<p>GOSSIPS or G, VOCABULARY or V</p>")
                            } break;
                        }


                    } break;

                    case "CapsLock": {
                        caps = !caps
                    } break;

                    case "ArrowLeft":
                    case "ArrowRight":
                    case "ArrowDown":
                    case "ArrowUp":
                    case "Shift":
                    case "Control":
                    case "Tab":
                    case "Alt":
                    case "F1": case "F2": case "F3": case "F4": case "F5": case "F6": case "F7": case "F8": case "F10": case "F11": case "F12": 
                    break;

                    
                    default: {
                        input = input.toLowerCase()
                        if (caps || e.shiftKey) input = input.toUpperCase()
                        prompt.innerHTML += input
                    } break;
                }
            }
            }

    </script>
</head>
<body>

</body>
</html>